"use strict";(self.webpackChunk_irmos_source=self.webpackChunk_irmos_source||[]).push([[640],{"./libs/shared/ui/src/lib/health-scatter-plot/health-scatter-plot.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>HealthScatterPlotComponent});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),common_module_Dx7dWex5=__webpack_require__("./node_modules/@angular/common/fesm2022/common_module-Dx7dWex5.mjs"),highcharts=__webpack_require__("./node_modules/highcharts/highcharts.js"),highcharts_angular=__webpack_require__("./node_modules/highcharts-angular/fesm2022/highcharts-angular.mjs"),lib_esm=__webpack_require__("./node_modules/ml-regression-polynomial/lib-esm/index.js");function polynomialRegression(x,y,degree){if(x.length!==y.length||0===x.length)return console.warn("Polynomial regression: Invalid input lengths.",{x,y}),[];try{const regression=new lib_esm.Y(x,y,degree);return regression.coefficients.every((v=>Number.isFinite(v)))?regression.coefficients:(console.warn("Polynomial regression: Non-finite coefficients returned.",regression.coefficients),[])}catch(err){return console.warn("Polynomial regression failed:",err),[]}}function generateRegressionPoints(coeffs,start,end,resolution=100){const result=[];for(let i=0;i<=resolution;i++){const x=start+i/resolution*(end-start),y=coeffs.reduce(((sum,c,j)=>sum+c*x**j),0);result.push([x,y])}return result}let HealthScatterPlotComponent=class HealthScatterPlotComponent{Highcharts=highcharts;measurements=(0,core.input)([]);warningThreshold=(0,core.input)(50);criticalThreshold=(0,core.input)(80);labelX=(0,core.input)("Time");labelY=(0,core.input)("Stiffness Change");chartTitle=(0,core.input)("");regressionEnabled=(0,core.input)(!0);regressionDegree=(0,core.input)(3);chartOptionsSignal=(0,core.computed)((()=>this.buildChartOptions()));buildChartOptions(){const data=this.measurements(),isForecastingEnabled=this.regressionEnabled(),groupedPoints=this.groupByThresholds(data),minTs=this.getMinTimestamp(data),maxTs=this.getMaxTimestamp(data),xMax=maxTs+.3*(maxTs-minTs),now=Date.now(),yMax=this.computeYMax(data),series=this.createScatterSeries(groupedPoints);return isForecastingEnabled&&data.length>1&&this.addRegressionSeries(series,data,minTs,maxTs,xMax),{chart:{type:"scatter",zooming:{type:"xy"},height:"fit-content",events:{load:function(){if(!isForecastingEnabled)return;const todayX=Date.now();this.renderer.text("Forecast â†’",this.plotLeft+this.xAxis[0].toPixels(todayX,!0)+5,this.plotTop+15).css({color:"#2B3057",fontSize:"12px",fontWeight:"bold"}).add()}}},exporting:{enabled:!0,buttons:{contextButton:{verticalAlign:"bottom",align:"left"}}},title:{text:this.chartTitle()},xAxis:{type:"datetime",title:{text:this.labelX()},max:xMax,plotLines:[this.createTodayPlotLine(now)]},yAxis:{min:0,max:yMax,title:{text:this.labelY()},plotLines:this.createThresholdPlotLines()},tooltip:{formatter(){const date=this.x?highcharts.dateFormat("%e. %b %Y",this.x):"N/A",value="number"==typeof this.y?this.y.toFixed(2):"N/A";return"arearange"!==this.series?.type&&`Date: <b>${date}</b><br/>Value: <b>${value}</b>`}},legend:{enabled:!0},plotOptions:{scatter:{marker:{radius:5,symbol:"circle",states:{hover:{enabled:!0}}}}},series}}groupByThresholds(data){const warning=this.warningThreshold(),critical=this.criticalThreshold(),grouped={healthy:[],warning:[],critical:[]};for(const{timestamp,value}of data){const point={x:new Date(timestamp).getTime(),y:value};value<=warning?grouped.healthy.push(point):value<=critical?grouped.warning.push(point):grouped.critical.push(point)}return grouped}getMinTimestamp(data){return Math.min(...data.map((d=>new Date(d.timestamp).getTime())))}getMaxTimestamp(data){return Math.max(...data.map((d=>new Date(d.timestamp).getTime())))}computeYMax(data){const maxValue=Math.max(...data.map((d=>d.value))),yPadding=.2*maxValue;return Math.max(120,10*Math.ceil((maxValue+yPadding)/10))}createScatterSeries(grouped){return[{name:"Healthy",type:"scatter",data:grouped.healthy,color:"#76996E"},{name:"Warning",type:"scatter",data:grouped.warning,color:"#F4AC32"},{name:"Critical",type:"scatter",data:grouped.critical,color:"#C42021"}]}addRegressionSeries(series,data,minTs,maxTs,xMax){const x=data.map((m=>new Date(m.timestamp).getTime())),y=data.map((m=>m.value)),{lower,upper,all}=function binAndSelectExtremes(x,y,binCount=24){if(x.length!==y.length)throw new Error("x and y must be same length");const n=x.length;if(0===n)return{lower:[],upper:[],all:[]};const minX=Math.min(...x),binSize=(Math.max(...x)-minX)/binCount,bins=Array(binCount).fill(null).map((()=>({})));for(let i=0;i<n;i++){const xi=x[i],yi=y[i],bin=bins[Math.min(Math.floor((xi-minX)/binSize),binCount-1)];(!bin.lower||yi<bin.lower[1])&&(bin.lower=[xi,yi]),(!bin.upper||yi>bin.upper[1])&&(bin.upper=[xi,yi])}return{lower:bins.flatMap((b=>b.lower?[b.lower]:[])),upper:bins.flatMap((b=>b.upper?[b.upper]:[])),all:x.map(((xi,i)=>[xi,y[i]]))}}(x,y,Math.min(x.length,24)),degree=this.regressionDegree(),avgCoeffs=polynomialRegression(all.map((p=>p[0])),all.map((p=>p[1])),degree),upperCoeffs=polynomialRegression(upper.map((p=>p[0])),upper.map((p=>p[1])),degree),lowerCoeffs=polynomialRegression(lower.map((p=>p[0])),lower.map((p=>p[1])),degree);series.push({type:"spline",name:"Trendline",data:generateRegressionPoints(avgCoeffs,minTs,xMax,50),color:"#2B3057",dashStyle:"ShortDash",marker:{enabled:!1},enableMouseTracking:!1,states:{hover:{lineWidth:0}}});const areaData=function createAreaRangeData(lowerPoints,upperPoints){return lowerPoints.map(((p,i)=>[p[0],p[1],upperPoints[i][1]]))}(generateRegressionPoints(lowerCoeffs,maxTs,xMax,50),generateRegressionPoints(upperCoeffs,maxTs,xMax,50));series.push({type:"arearange",name:"Confidence Interval",data:areaData,color:"#6B9AC4",fillOpacity:.3,lineWidth:0,enableMouseTracking:!1,marker:{enabled:!1}})}createTodayPlotLine(now){return{color:"#2B3057",width:2,value:now,zIndex:20,dashStyle:"Dash",label:{text:"Today",rotation:0,align:"right",x:-5,y:15,style:{color:"#2B3057",fontWeight:"bold"}}}}createThresholdPlotLines(){return[{color:"#F4AC32",width:2,value:this.warningThreshold(),dashStyle:"Dash",label:{text:"Warning",align:"right",style:{color:"#F4AC32"}}},{color:"#C42021",width:2,value:this.criticalThreshold(),dashStyle:"Dash",label:{text:"Critical",align:"right",style:{color:"#C42021"}}}]}static propDecorators={measurements:[{type:core.Input,args:[{isSignal:!0,alias:"measurements",required:!1,transform:void 0}]}],warningThreshold:[{type:core.Input,args:[{isSignal:!0,alias:"warningThreshold",required:!1,transform:void 0}]}],criticalThreshold:[{type:core.Input,args:[{isSignal:!0,alias:"criticalThreshold",required:!1,transform:void 0}]}],labelX:[{type:core.Input,args:[{isSignal:!0,alias:"labelX",required:!1,transform:void 0}]}],labelY:[{type:core.Input,args:[{isSignal:!0,alias:"labelY",required:!1,transform:void 0}]}],chartTitle:[{type:core.Input,args:[{isSignal:!0,alias:"chartTitle",required:!1,transform:void 0}]}],regressionEnabled:[{type:core.Input,args:[{isSignal:!0,alias:"regressionEnabled",required:!1,transform:void 0}]}],regressionDegree:[{type:core.Input,args:[{isSignal:!0,alias:"regressionDegree",required:!1,transform:void 0}]}]}};HealthScatterPlotComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"lib-health-scatter-plot",standalone:!0,imports:[common_module_Dx7dWex5.MD,highcharts_angular._],changeDetection:core.ChangeDetectionStrategy.OnPush,template:'\n    @if(measurements().length > 0) {\n      <highcharts-chart class="w-full block" [Highcharts]="Highcharts" [options]="chartOptionsSignal()" />\n    } @else {\n      <div class="text-center">No measurements available</div>\n    }\n  '})],HealthScatterPlotComponent)},"./libs/shared/ui/src/lib/health-scatter-plot/health-scatter-plot.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,WithoutDataPoints:()=>WithoutDataPoints,WithoutForecasting:()=>WithoutForecasting,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _storybook_angular__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),_health_scatter_plot_component__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./libs/shared/ui/src/lib/health-scatter-plot/health-scatter-plot.component.ts"),_angular_platform_browser_animations__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular/platform-browser/fesm2022/animations.mjs"),highcharts_angular__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/highcharts-angular/fesm2022/highcharts-angular.mjs");const __WEBPACK_DEFAULT_EXPORT__={title:"Charts/HealthScatterPlot",component:_health_scatter_plot_component__WEBPACK_IMPORTED_MODULE_1__.x,decorators:[(0,_storybook_angular__WEBPACK_IMPORTED_MODULE_0__.moduleMetadata)({imports:[_angular_platform_browser_animations__WEBPACK_IMPORTED_MODULE_2__.BrowserAnimationsModule,highcharts_angular__WEBPACK_IMPORTED_MODULE_3__._],providers:[(0,_angular_platform_browser_animations__WEBPACK_IMPORTED_MODULE_2__.provideAnimations)()]})],tags:["autodocs"],parameters:{docs:{description:{component:"\nDisplays a time series of measurement values (e.g. stiffness change)\nas a scatter plot with color-coded data points and threshold indicators.\nSupports polynomial regression to visualize long-term trends."}}},argTypes:{chartTitle:{control:"text",description:"Title displayed above the chart."},labelX:{control:"text",description:"Label for the horizontal (X) axis, typically a time dimension."},labelY:{control:"text",description:"Label for the vertical (Y) axis, representing measured values."},warningThreshold:{control:{type:"range",min:50,max:100,step:1},description:"Values above this threshold are highlighted in orange."},criticalThreshold:{control:{type:"range",min:60,max:120,step:1},description:"Values above this threshold are highlighted in red."},regressionEnabled:{control:"boolean",description:"Enables regression analysis to show a trend line through the data points.\nWhen activated, a regression curve is fitted to the measurements."},regressionDegree:{control:{type:"range",min:1,max:12,step:1},description:"Specifies the degree of the polynomial regression.\n\nA degree of 1 produces a straight line (linear regression), while higher values\nallow for more flexible curves (e.g., 2 = quadratic, 3 = cubic).\n\n- Too low: may underfit and miss important trends.\n- Too high: may overfit and follow random noise in the data."},measurements:{control:!1,description:"Array of measurement data points, each containing a timestamp (ISO string)\nand a numeric value. These points are plotted on the chart."}},render:args=>({component:_health_scatter_plot_component__WEBPACK_IMPORTED_MODULE_1__.x,props:args})},Default={name:"Default Plot",args:{measurements:Array.from({length:180},((_,i)=>{const daysAgo=180-i,timestamp=new Date;timestamp.setUTCDate(timestamp.getUTCDate()-daysAgo);const baseValue=55+20/180*i,noise=Math.pow(1.015,i+50)*(Math.random()-.5),value=Math.round(10*(baseValue+noise))/10;return{timestamp:timestamp.toISOString(),value}})),warningThreshold:65,criticalThreshold:80,chartTitle:"Stiffness Change (6-Month View)",labelX:"Date",labelY:"Stiffness Change",regressionEnabled:!0,regressionDegree:3}},WithoutForecasting={name:"Without Forecasting",args:{...Default.args,regressionEnabled:!1}},WithoutDataPoints={name:"Without Data Points",args:{...Default.args,measurements:[]}},__namedExportsOrder=["Default","WithoutForecasting","WithoutDataPoints"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  name: 'Default Plot',\n  args: {\n    measurements,\n    warningThreshold: 65,\n    criticalThreshold: 80,\n    chartTitle: 'Stiffness Change (6-Month View)',\n    labelX: 'Date',\n    labelY: 'Stiffness Change',\n    regressionEnabled: true,\n    regressionDegree: 3\n  }\n}",...Default.parameters?.docs?.source}}},WithoutForecasting.parameters={...WithoutForecasting.parameters,docs:{...WithoutForecasting.parameters?.docs,source:{originalSource:"{\n  name: 'Without Forecasting',\n  args: {\n    ...Default.args,\n    regressionEnabled: false\n  }\n}",...WithoutForecasting.parameters?.docs?.source}}},WithoutDataPoints.parameters={...WithoutDataPoints.parameters,docs:{...WithoutDataPoints.parameters?.docs,source:{originalSource:"{\n  name: 'Without Data Points',\n  args: {\n    ...Default.args,\n    measurements: []\n  }\n}",...WithoutDataPoints.parameters?.docs?.source}}}}}]);